<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
                                   "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd">
<hibernate-mapping default-access="field" package="org.libreplan.business.planner.entities">
 <!-- ResourceAllocation -->
 <class name="ResourceAllocation" table="resource_allocation">
  <id column="id" name="id" type="long">
   <generator class="increment">
    <param name="max_lo">100</param>
   </generator>
  </id>
  <version generated="never" name="version" type="long"/>
  <property column="resources_per_day" generated="never" lazy="false"
   name="resourcesPerDay" type="org.libreplan.business.workingday.hibernate.ResourcesPerDayType"/>
  <property column="intended_resources_per_day" generated="never"
   lazy="false" name="intendedResourcesPerDay" type="org.libreplan.business.workingday.hibernate.ResourcesPerDayType"/>
  <property column="intended_total_hours" generated="never" lazy="false" name="intendedTotalHours"/>
  <property access="field" column="intended_total_assignment"
   generated="never" lazy="false" name="intendedTotalAssignment" type="org.libreplan.business.workingday.hibernate.EffortDurationType"/>
  <property access="field" column="intended_non_consolidated_effort"
   generated="never" lazy="false" name="intendedNonConsolidatedEffort" type="org.libreplan.business.workingday.hibernate.EffortDurationType"/>
  <!-- Indexed -->
  <many-to-one class="Task" column="task"
   index="idx_resource_allocation_on_task" name="task"/>
  <!-- It is not included index, navigation from assignment function to ResourceAllocation not useful -->
  <many-to-one cascade="all" class="AssignmentFunction"
   column="assignment_function" lazy="false" name="assignmentFunction" not-null="false"/>
  <set cascade="all-delete-orphan" inverse="true"
   name="derivedAllocations" sort="unsorted">
   <key column="resource_allocation_id"/>
   <one-to-many class="DerivedAllocation"/>
  </set>
  <!-- Wrong mapping. A ResourceAllocation only has one limiting resource queue element associated -->
  <set cascade="all-delete-orphan" inverse="true"
   name="limitingResourceQueueElements" sort="unsorted">
   <key column="resource_allocation_id"/>
   <one-to-many class="org.libreplan.business.planner.limiting.entities.LimitingResourceQueueElement"/>
  </set>
  <joined-subclass name="SpecificResourceAllocation" table="specific_resource_allocation">
   <key column="resource_allocation_id"/>
   <many-to-one
    class="org.libreplan.business.resources.entities.Resource" name="resource"/>
   <set cascade="all-delete-orphan"
    name="specificDayAssignmentsContainers" sort="unsorted">
    <key column="resource_allocation_id"/>
    <one-to-many class="SpecificDayAssignmentsContainer"/>
   </set>
  </joined-subclass>
  <joined-subclass name="GenericResourceAllocation" table="generic_resource_allocation">
   <key column="resource_allocation_id"/>
   <set name="criterions" sort="unsorted" table="all_criterions">
    <key column="generic_resource_allocation_id"/>
    <many-to-many
     class="org.libreplan.business.resources.entities.Criterion"
     column="criterion_id" unique="false"/>
   </set>
   <property column="resource_type" generated="never" lazy="false" name="resourceType">
    <type name="org.hibernate.type.EnumType">
     <param name="enumClass">org.libreplan.business.resources.entities.ResourceEnum</param>
    </type>
   </property>
   <set cascade="all-delete-orphan"
    name="genericDayAssignmentsContainers" sort="unsorted">
    <key column="resource_allocation_id"/>
    <one-to-many class="GenericDayAssignmentsContainer"/>
   </set>
  </joined-subclass>
 </class>
 <class name="SpecificDayAssignmentsContainer" table="specific_day_assignments_container">
  <id name="id" type="long">
   <generator class="increment">
    <param name="max_lo">100</param>
   </generator>
  </id>
  <version generated="never" name="version" type="long"/>
  <!--
        natural-id use has to be discarded due to:
        Resource allocation and scenario should be an unique key.

        natural-id could be used for that but was discarded due to:
        https://forum.hibernate.org/viewtopic.php?p=2372348
        -->
  <many-to-one column="resource_allocation_id" name="resourceAllocation"/>
  <many-to-one name="scenario"/>
  <component class="org.libreplan.business.workingday.IntraDayDate" name="intraDayStart">
   <property column="start_date" generated="never" lazy="false" name="date"/>
   <property column="duration_start_in_first_day" generated="never"
    lazy="false" name="effortDuration" type="org.libreplan.business.workingday.hibernate.EffortDurationType"/>
  </component>
  <component class="org.libreplan.business.workingday.IntraDayDate" name="intraDayEnd">
   <property column="end_date" generated="never" lazy="false" name="date"/>
   <property column="duration_in_last_day" generated="never"
    lazy="false" name="effortDuration" type="org.libreplan.business.workingday.hibernate.EffortDurationType"/>
  </component>
  <set cascade="all-delete-orphan" name="dayAssignments" sort="unsorted">
   <key column="specific_container_id"/>
   <one-to-many class="SpecificDayAssignment"/>
  </set>
 </class>
 <class name="GenericDayAssignmentsContainer" table="generic_day_assignments_container">
  <id name="id" type="long">
   <generator class="increment">
    <param name="max_lo">100</param>
   </generator>
  </id>
  <version generated="never" name="version" type="long"/>
  <!--
        natural-id use has to be discarded due to:
        Resource allocation and scenario should be an unique key.

        natural-id could be used for that but was discarded due to:
        https://forum.hibernate.org/viewtopic.php?p=2372348
        -->
  <many-to-one column="resource_allocation_id" name="resourceAllocation"/>
  <many-to-one name="scenario"/>
  <component class="org.libreplan.business.workingday.IntraDayDate" name="intraDayStart">
   <property column="start_date" generated="never" lazy="false" name="date"/>
   <property column="duration_start_in_first_day" generated="never"
    lazy="false" name="effortDuration" type="org.libreplan.business.workingday.hibernate.EffortDurationType"/>
  </component>
  <component class="org.libreplan.business.workingday.IntraDayDate" name="intraDayEnd">
   <property column="end_date" generated="never" lazy="false" name="date"/>
   <property column="duration_in_last_day" generated="never"
    lazy="false" name="effortDuration" type="org.libreplan.business.workingday.hibernate.EffortDurationType"/>
  </component>
  <set cascade="all-delete-orphan" name="dayAssignments" sort="unsorted">
   <key column="generic_container_id"/>
   <one-to-many class="GenericDayAssignment"/>
  </set>
 </class>
 <class name="DerivedDayAssignmentsContainer" table="derived_day_assignments_container">
  <id name="id" type="long">
   <generator class="increment">
    <param name="max_lo">100</param>
   </generator>
  </id>
  <version generated="never" name="version" type="long"/>
  <!--
        natural-id use has to be discarded due to:
        Resource allocation and scenario should be an unique key.

        natural-id could be used for that but was discarded due to:
        https://forum.hibernate.org/viewtopic.php?p=2372348
        -->
  <many-to-one column="derived_allocation_id" name="resourceAllocation"/>
  <many-to-one name="scenario"/>
  <set cascade="all-delete-orphan" name="dayAssignments" sort="unsorted">
   <key column="derived_container_id"/>
   <one-to-many class="DerivedDayAssignment"/>
  </set>
 </class>
 <!-- LimitingResourceQueueElement -->
 <class
  name="org.libreplan.business.planner.limiting.entities.LimitingResourceQueueElement" table="limiting_resource_queue_element">
  <id name="id" type="long">
   <generator class="increment">
    <param name="max_lo">100</param>
   </generator>
  </id>
  <version generated="never" name="version" type="long"/>
  <many-to-one cascade="all" column="resource_allocation_id"
   name="resourceAllocation" not-null="false" unique="true"/>
  <!-- Indexed -->
  <many-to-one column="limiting_resource_queue_id"
   index="idx_resource_queue_element_on_resource_queue" name="limitingResourceQueue"/>
  <property column="earlier_start_date_because_of_gantt"
   generated="never" lazy="false" name="earlierStartDateBecauseOfGantt"/>
  <property column="earliest_end_date_because_of_gantt"
   generated="never" lazy="false" name="earliestEndDateBecauseOfGantt"/>
  <property column="creation_timestamp" generated="never" lazy="false" name="creationTimestamp"/>
  <component
   class="org.libreplan.business.planner.limiting.entities.QueuePosition" name="startQueuePosition">
   <property column="start_date" generated="never" lazy="false"
    name="date" type="date"/>
   <property column="start_hour" generated="never" lazy="false" name="hour"/>
  </component>
  <component
   class="org.libreplan.business.planner.limiting.entities.QueuePosition" name="endQueuePosition">
   <property column="end_date" generated="never" lazy="false"
    name="date" type="date"/>
   <property column="end_hour" generated="never" lazy="false" name="hour"/>
  </component>
  <!--  Indexed the other side. Useful to browse the output dependencies of a LimitingResourceQueueElement -->
  <set lazy="false" name="dependenciesAsOrigin" sort="unsorted">
   <key column="origin_queue_element_id"/>
   <one-to-many class="org.libreplan.business.planner.limiting.entities.LimitingResourceQueueDependency"/>
  </set>
  <!-- Indexed the other side. Useful to browse the input dependencies of a LimitingResourceQueueElement -->
  <set lazy="false" name="dependenciesAsDestiny" sort="unsorted">
   <key column="destiny_queue_element_id"/>
   <one-to-many class="org.libreplan.business.planner.limiting.entities.LimitingResourceQueueDependency"/>
  </set>
 </class>
 <!-- LimitingResourceQueueDependency -->
 <class
  name="org.libreplan.business.planner.limiting.entities.LimitingResourceQueueDependency" table="limiting_resource_queue_dependency">
  <id name="id" type="long">
   <generator class="increment">
    <param name="max_lo">100</param>
   </generator>
  </id>
  <property generated="never" lazy="false" name="type">
   <type name="org.hibernate.type.EnumType">
    <param name="enumClass">org.libreplan.business.planner.limiting.entities.LimitingResourceQueueDependency$QueueDependencyType</param>
   </type>
  </property>
  <!--  Indexed -->
  <many-to-one
   class="org.libreplan.business.planner.limiting.entities.LimitingResourceQueueElement"
   column="origin_queue_element_id"
   index="idx_queue_dependency_on_origin_queue" name="hasAsOrigin" not-null="false"/>
  <!-- Indexed -->
  <many-to-one
   class="org.libreplan.business.planner.limiting.entities.LimitingResourceQueueElement"
   column="destiny_queue_element_id"
   index="idx_queue_dependency_on_destiny_queue" name="hasAsDestiny" not-null="false"/>
  <one-to-one class="Dependency" name="ganttDependency" property-ref="queueDependency"/>
 </class>
 <!-- DayAssignment -->
 <class name="DayAssignment" table="day_assignment">
  <id name="id" type="long">
   <generator class="increment">
    <param name="max_lo">100</param>
   </generator>
  </id>
  <discriminator column="day_assignment_type" force="false"
   insert="true" not-null="true"/>
  <version generated="never" name="version" type="long"/>
  <property generated="never" lazy="false" name="duration"
   not-null="true" type="org.libreplan.business.workingday.hibernate.EffortDurationType"/>
  <property access="field" generated="never" lazy="false" name="consolidated"/>
  <property generated="never" lazy="false" name="day"/>
  <!--
        Not indexed.
        It is not indexed because it is regarded that to navigate from a resource to all his DayAssignments is not useful.
        -->
  <many-to-one
   class="org.libreplan.business.resources.entities.Resource"
   column="resource_id" name="resource" not-null="true"/>
  <!-- SpecificDayAssignment -->
  <subclass discriminator-value="specific_day"
   name="SpecificDayAssignment" select-before-update="false">
   <many-to-one column="specific_container_id" name="container"/>
  </subclass>
  <!-- GenericDayAssignment -->
  <subclass discriminator-value="generic_day"
   name="GenericDayAssignment" select-before-update="false">
   <many-to-one column="generic_container_id" name="container"/>
  </subclass>
  <subclass discriminator-value="derived_day"
   name="DerivedDayAssignment" select-before-update="false">
   <many-to-one column="derived_container_id" name="container"/>
  </subclass>
 </class>
 <!-- AssignmentFunction -->
 <class name="AssignmentFunction" table="assignment_function">
  <id name="id" type="long">
   <generator class="increment">
    <param name="max_lo">100</param>
   </generator>
  </id>
  <version generated="never" name="version" type="long"/>
  <joined-subclass name="StretchesFunction" table="stretches_function">
   <key column="assignment_function_id"/>
   <list name="stretches" table="stretches">
    <key column="assignment_function_id"/>
    <list-index base="0" column="stretch_position"/>
    <composite-element class="Stretch">
     <property column="length_percentage" generated="never" lazy="false"
      name="lengthPercentage" not-null="true"/>
     <property column="amount_work_percentage" generated="never"
      lazy="false" name="amountWorkPercentage" not-null="true"/>
    </composite-element>
   </list>
   <property generated="never" lazy="false" name="type">
    <type name="org.hibernate.type.EnumType">
     <param name="enumClass">org.libreplan.business.planner.entities.StretchesFunctionTypeEnum</param>
    </type>
   </property>
  </joined-subclass>
  <joined-subclass name="SigmoidFunction" table="sigmoid_function">
   <key column="assignment_function_id"/>
  </joined-subclass>
  <joined-subclass name="ManualFunction" table="manual_function">
   <key column="assignment_function_id"/>
  </joined-subclass>
 </class>
 <class name="DerivedAllocation" table="derived_allocation">
  <id name="id" type="long">
   <generator class="increment">
    <param name="max_lo">100</param>
   </generator>
  </id>
  <version generated="never" name="version" type="long"/>
  <many-to-one class="ResourceAllocation"
   column="resource_allocation_id" name="derivedFrom"/>
  <many-to-one
   class="org.libreplan.business.resources.entities.MachineWorkersConfigurationUnit"
   name="configurationUnit" not-null="true"/>
  <set cascade="all-delete-orphan"
   name="derivedDayAssignmentsContainers" sort="unsorted">
   <key column="derived_allocation_id"/>
   <one-to-many class="DerivedDayAssignmentsContainer"/>
  </set>
 </class>
</hibernate-mapping>
