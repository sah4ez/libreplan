<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
                                   "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd">
<hibernate-mapping default-access="field" package="org.libreplan.business.calendars.entities">
 <!-- BaseCalendar -->
 <class name="BaseCalendar" table="base_calendar">
  <cache include="all" usage="read-write"/>
  <id name="id" type="long">
   <generator class="increment">
    <param name="max_lo">100</param>
   </generator>
  </id>
  <version generated="never" name="version" type="long"/>
  <property generated="never" lazy="false" name="code" not-null="true" unique="true"/>
  <property access="field" generated="never" lazy="false" name="name"/>
  <property access="field" column="code_autogenerated" generated="never"
   lazy="false" name="codeAutogenerated"/>
  <property access="field" column="last_sequence_code" generated="never"
   lazy="false" name="lastSequenceCode"/>
  <!-- Index created in a database-object section -->
  <set access="field" batch-size="10" cascade="all-delete-orphan"
   lazy="false" name="exceptions" sort="unsorted">
   <key column="base_calendar_id"/>
   <one-to-many class="CalendarException"/>
  </set>
  <!-- Index created in a database-object section -->
  <list access="field" batch-size="10" cascade="all-delete-orphan"
   lazy="false" name="calendarDataVersions">
   <key column="base_calendar_id"/>
   <index column="position_in_calendar"/>
   <one-to-many class="CalendarData"/>
  </list>
  <!-- Not indexed -->
  <list access="field" batch-size="10" cascade="all-delete-orphan"
   lazy="false" name="calendarAvailabilities">
   <key column="base_calendar_id"/>
   <index column="position_in_calendar"/>
   <one-to-many class="CalendarAvailability"/>
  </list>
  <joined-subclass lazy="false" name="ResourceCalendar" table="resource_calendar">
   <key column="base_calendar_id"/>
   <property generated="never" lazy="false" name="capacity" not-null="true"/>
   <one-to-one access="field"
    class="org.libreplan.business.resources.entities.Resource"
    name="resource" property-ref="calendar"/>
  </joined-subclass>
 </class>
 <!-- CalendarException -->
 <class name="CalendarException" table="calendar_exception">
  <id name="id" type="long">
   <generator class="increment">
    <param name="max_lo">100</param>
   </generator>
  </id>
  <version generated="never" name="version" type="long"/>
  <property generated="never" lazy="false" name="code" not-null="true" unique="true"/>
  <property access="field" generated="never" lazy="false" name="date"/>
  <component class="org.libreplan.business.calendars.entities.Capacity" name="capacity">
   <property column="standard_effort" generated="never" lazy="false"
    name="standardEffort" type="org.libreplan.business.workingday.hibernate.EffortDurationType"/>
   <property column="allowed_extra_effort" generated="never"
    lazy="false" name="allowedExtraEffort" type="org.libreplan.business.workingday.hibernate.EffortDurationType"/>
  </component>
  <!-- Not indexed -->
  <many-to-one column="calendar_exception_id" name="type"/>
 </class>
 <!-- CalendarExceptionType -->
 <class name="CalendarExceptionType" table="calendar_exception_type">
  <id name="id" type="long">
   <generator class="increment">
    <param name="max_lo">100</param>
   </generator>
  </id>
  <version generated="never" name="version" type="long"/>
  <property generated="never" lazy="false" name="code" not-null="true" unique="true"/>
  <property access="field" column="code_autogenerated" generated="never"
   lazy="false" name="codeAutogenerated" not-null="true"/>
  <property generated="never" lazy="false" name="name" unique="true"/>
  <property access="field" generated="never" lazy="false" name="updatable"/>
  <property generated="never" lazy="false" name="color">
   <type name="org.hibernate.type.EnumType">
    <param name="enumClass">org.libreplan.business.calendars.entities.CalendarExceptionTypeColor</param>
    <param name="useNamed">true</param>
   </type>
  </property>
  <component class="org.libreplan.business.calendars.entities.Capacity" name="capacity">
   <property column="standard_effort" generated="never" lazy="false"
    name="standardEffort" type="org.libreplan.business.workingday.hibernate.EffortDurationType"/>
   <property column="allowed_extra_effort" generated="never"
    lazy="false" name="allowedExtraEffort" type="org.libreplan.business.workingday.hibernate.EffortDurationType"/>
  </component>
 </class>
 <!-- CalendarData -->
 <class name="CalendarData" table="calendar_data">
  <id name="id" type="long">
   <generator class="increment">
    <param name="max_lo">100</param>
   </generator>
  </id>
  <version generated="never" name="version" type="long"/>
  <property generated="never" lazy="false" name="code" not-null="true" unique="true"/>
  <map lazy="false" name="capacityPerDay" sort="unsorted" table="capacity_per_day">
   <key column="base_calendar_id"/>
   <index column="day_id" type="integer"/>
   <composite-element class="org.libreplan.business.calendars.entities.Capacity">
    <property column="standard_effort" generated="never" lazy="false"
     name="standardEffort" type="org.libreplan.business.workingday.hibernate.EffortDurationType"/>
    <property column="allowed_extra_effort" generated="never"
     lazy="false" name="allowedExtraEffort" type="org.libreplan.business.workingday.hibernate.EffortDurationType"/>
   </composite-element>
  </map>
  <!-- Not indexed -->
  <many-to-one access="field" class="BaseCalendar" name="parent"/>
  <property access="field" column="expiring_date" generated="never"
   lazy="false" name="expiringDate"/>
 </class>
 <!-- CalendarAvailability -->
 <class name="CalendarAvailability" table="calendar_availability">
  <id name="id" type="long">
   <generator class="increment">
    <param name="max_lo">100</param>
   </generator>
  </id>
  <version generated="never" name="version" type="long"/>
  <property generated="never" lazy="false" name="code" not-null="true" unique="true"/>
  <property access="field" column="start_date" generated="never"
   lazy="false" name="startDate" type="org.jadira.usertype.dateandtime.joda.PersistentLocalDate"/>
  <property access="field" column="end_date" generated="never"
   lazy="false" name="endDate" type="org.jadira.usertype.dateandtime.joda.PersistentLocalDate"/>
 </class>
 <!-- Index to boost the search of CalendarExceptions inside BaseCalendar -->
 <database-object>
  <create><![CDATA[CREATE INDEX idx_calendar_exception_on_base_calendar ON calendar_exception (base_calendar_id)]]></create>
  <drop><![CDATA[DROP INDEX idx_calendar_exception_on_base_calendar]]></drop>
  <dialect-scope name="org.hibernate.dialect.PostgreSQL9Dialect"/>
  <dialect-scope name="org.hibernate.dialect.MySQL5InnoDBDialect"/>
 </database-object>
 <!-- Index to boost the search of CalendarData that hang from a BaseCalendar -->
 <database-object>
  <create><![CDATA[CREATE INDEX idx_calendar_data_on_base_calendar ON calendar_data (base_calendar_id)]]></create>
  <drop><![CDATA[DROP INDEX idx_calendar_data_on_base_calendar]]></drop>
  <dialect-scope name="org.hibernate.dialect.PostgreSQL9Dialect"/>
  <dialect-scope name="org.hibernate.dialect.MySQL5InnoDBDialect"/>
 </database-object>
</hibernate-mapping>
